<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Notes on eia2 development • eia2</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Notes on eia2 development"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">eia2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Notes on eia2 development</h1>
      
    </div>

<div id="notes-on-eia2-development" class="section level1">

<ul><li>support keyring for storing api_key securely</li>
<li>roundtrip request -&gt; perform -&gt; extract request from response</li>
<li>test suite (including tests that run on CRAN)
<ul><li>test of low-level query_params_expand</li>
<li>test that url’s are constructed as expected</li>
<li>tests for API assumptions (that do not run on CRAN)</li>
<li>tests along the lines of DB test suite</li>
<li>ensure API credentials don’t leak</li>
</ul></li>
<li>CI / Github Actions</li>
<li>caching of API requests</li>
<li>README</li>
<li>Suggested citation for EIA data with citHeader and citEntry? <a href="https://devguide.ropensci.org/building.html" class="external-link uri">https://devguide.ropensci.org/building.html</a>
</li>
<li>Getting started vignette</li>
<li>Further split low-level function (that is flexible, close to API vocab, and won’t break) from high-level UI functions</li>
<li>Low-level helper for query parameters</li>
<li>progress bar?: <a href="https://github.com/r-lib/httr2/issues/20" class="external-link uri">https://github.com/r-lib/httr2/issues/20</a>
</li>
<li>autocompletion of available metadata?</li>
<li>shiny app like the query browser?</li>
<li>pkgdown</li>
<li>test coverage</li>
<li>ropensci package dev guide</li>
<li>print method for friendlier response? (subtype of httr2 response type?)</li>
<li>pretty printing with e.g., cli?</li>
<li>use of vcr for recording API responses?</li>
<li>DESCRIPTION file details, licensing, authorship, crediting</li>
</ul><div class="section level2">
<h2 id="resources">Resources:<a class="anchor" aria-label="anchor" href="#resources"></a></h2>
<ul><li>HTTP testing in R book: <a href="https://books.ropensci.org/http-testing/index.html" class="external-link uri">https://books.ropensci.org/http-testing/index.html</a>
</li>
<li>Video of UseR 2021 Tutorial on package testing: <a href="https://www.youtube.com/watch?v=tzQGg1kAzGs&amp;t=4650s&amp;ab_channel=RConsortium" class="external-link uri">https://www.youtube.com/watch?v=tzQGg1kAzGs&amp;t=4650s&amp;ab_channel=RConsortium</a>
</li>
<li>rOpenSci Package DevGuide: <a href="https://devguide.ropensci.org/" class="external-link uri">https://devguide.ropensci.org/</a>
</li>
<li>R Packages book: <a href="https://r-pkgs.org/" class="external-link uri">https://r-pkgs.org/</a>
</li>
<li>httr2 vignette, “Wrapping APIs”: <a href="https://httr2.r-lib.org/articles/wrapping-apis.html" class="external-link uri">https://httr2.r-lib.org/articles/wrapping-apis.html</a>
</li>
</ul></div>
<div class="section level2">
<h2 id="test-suite">Test Suite<a class="anchor" aria-label="anchor" href="#test-suite"></a></h2>
</div>
<div class="section level2">
<h2 id="continuous-integration">Continuous Integration<a class="anchor" aria-label="anchor" href="#continuous-integration"></a></h2>
<p>Ropensci advice re: CI (including Feb 2023 community call). r-lib github actions example of CI in eia package (although some is outdated)</p>
</div>
<div class="section level2">
<h2 id="caching-api-requests">Caching API Requests<a class="anchor" aria-label="anchor" href="#caching-api-requests"></a></h2>
<p>The httr2 package has response caching, but it is based on whether the API reports that it is cachable and when the results expire. In the case of the EIA API, the expiration is nearly immediate, so no significant caching is possible through the httr2 mechanism. It could be that is the right approach.</p>
<p>The eia package did within-session caching of requests via memoisation. This seems like it could be a feasible approach.</p>
<p>Within targets pipelines results are cached, and it would be wonderful to have better tools for specifying how a target based on an API call is invalidated.</p>
<p>Probably other ropensci API packages have examples of best-practice caching.</p>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies:<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<p>R &gt;= 4.1.0 b/c of pipe purrr &gt;= 1.0.0 b/c of pluck_depth</p>
</div>
<div class="section level2">
<h2 id="low-level-helper-to-build-arraynested-query-parameters">Low-level helper to build array/nested query parameters<a class="anchor" aria-label="anchor" href="#low-level-helper-to-build-arraynested-query-parameters"></a></h2>
<p>The EIAv2 API has several query parameters which are nested. However, the httr2 functions for adding query parameters to requests only work for length-1 atomic query parameters. I would like to do my best to document the extent to which there are HTTP standard formats that could be comprehensively supported for array/nested query parameters (not just the EIA API).</p>
<p>Specification: - application/x-www-form-urlencoded<br>
- <a href="https://www.rfc-editor.org/rfc/rfc3875#section-4.1.7" class="external-link uri">https://www.rfc-editor.org/rfc/rfc3875#section-4.1.7</a></p>
<p>I looked into a number of packages which are mentioned in the CRAN task view for web/http, but did not find a package covering the need.</p>
<p>Packages I checked: - webutils (ropensci) - urltools - request - httpuv (rstudio) -&gt; ? - V8 ?</p>
<div class="section level3">
<h3 id="webutils">webutils<a class="anchor" aria-label="anchor" href="#webutils"></a></h3>
</div>
<div class="section level3">
<h3 id="urltools">urltools<a class="anchor" aria-label="anchor" href="#urltools"></a></h3>
<p>library(urltools) urltools::param_set(“example.com”, “x”, c(1, 2))</p>
</div>
<div class="section level3">
<h3 id="request">request<a class="anchor" aria-label="anchor" href="#request"></a></h3>
<p>r &lt;- request(“example.com”) str(r) r |&gt; cat(rawToChar(r$content))</p>
</div>
<div class="section level3">
<h3 id="httpuv">httpuv<a class="anchor" aria-label="anchor" href="#httpuv"></a></h3>
<p>httpuv::encodeURI</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jameel Alsalam.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

